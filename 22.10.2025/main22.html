<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Диаграммы требований</title>
<style>
:root{
  --bg:#0d1f12;
  --card:#102417;
  --accent:#4ade80;
  --muted:#a7f3d0
}
html,body{
  height:100%;
  margin:0;
  background:linear-gradient(180deg,#071a10 0%,#0d1f12 100%);
  font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;
  color:#e8fbe7
}
.app{
  padding:18px;
  display:grid;
  grid-template-columns:1fr 420px;
  gap:16px;
  height:100vh;
  box-sizing:border-box
}
.canvas{
  background:linear-gradient(180deg,#0c2a16,rgba(255,255,255,0.02));
  border-radius:12px;
  padding:14px;
  overflow:auto
}
.sidebar{
  background:linear-gradient(180deg,#0e301a,rgba(255,255,255,0.02));
  border-radius:12px;
  padding:12px
}
.toolbar{
  display:flex;
  gap:8px;
  margin-bottom:12px
}
.btn{
  background:transparent;
  border:1px solid rgba(255,255,255,0.06);
  padding:8px 10px;
  border-radius:8px;
  color:var(--muted);
  cursor:pointer
}
.board{
  position:relative;
  min-height:1200px;
  border-radius:8px
}
.diagram{
  position:relative;
  margin:18px 0;
  padding:10px;
  border-radius:8px;
  background:rgba(255,255,255,0.01)
}
.title{
  font-weight:600;
  margin-bottom:8px;
  font-size:15px;
  color:#b9fbc0
}
.diagram-canvas{
  position:relative;
  height:260px;
  border-radius:6px
}
.node{
  position:absolute;
  min-width:140px;
  padding:10px;
  border-radius:8px;
  background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));
  box-shadow:0 6px 18px rgba(4,20,8,0.6);
  border:1px solid rgba(255,255,255,0.04);
  cursor:grab
}
.node:active{cursor:grabbing}
.node .label{min-height:20px;outline:none}
.svg-layer{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none}
.window-mock{
  width:100%;
  height:320px;
  background:linear-gradient(180deg,#0a2a14,#0d2614);
  border-radius:10px;
  padding:12px;
  box-sizing:border-box;
  border:1px solid rgba(255,255,255,0.03)
}
.win-header{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.win-dots{display:flex;gap:6px}
.dot{width:12px;height:12px;border-radius:50%}
.dot.r{background:#22c55e}
.dot.y{background:#84cc16}
.dot.g{background:#4ade80}
.form-row{display:flex;gap:8px;margin-bottom:8px}
.input{
  flex:1;
  background:rgba(255,255,255,0.02);
  border:1px solid rgba(255,255,255,0.03);
  padding:8px;
  border-radius:6px;
  color:#e8fbe7;
  outline:none
}
.btn-small{padding:6px 8px;border-radius:6px}
.table{width:100%;border-collapse:collapse}
.table td{padding:8px;border:1px solid rgba(255,255,255,0.03)}
.footer{margin-top:12px;font-size:12px;color:var(--muted)}
.legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.legend .item{font-size:12px;color:var(--muted);padding:6px 8px;border-radius:6px;background:rgba(255,255,255,0.01)}
</style>
</head>
<body>
<div class="app">
  <div class="canvas">
    <div class="toolbar">
      <button class="btn" id="addNode">Добавить узел</button>
      <button class="btn" id="reset">Сброс позиций</button>
      <button class="btn" id="exportBtn">Экспорт SVG</button>
    </div>
    <div class="board" id="board">

      <div class="diagram" data-type="tree">
        <div class="title">Дерево требований</div>
        <div class="diagram-canvas" id="canvas-tree">
          <svg class="svg-layer" id="svg-tree"></svg>
        </div>
      </div>

      <div class="diagram" data-type="functions">
        <div class="title">Основные функции и поток</div>
        <div class="diagram-canvas" id="canvas-functions">
          <svg class="svg-layer" id="svg-functions"></svg>
        </div>
      </div>

      <div class="diagram" data-type="nonfunc">
        <div class="title">Параметры качества</div>
        <div class="diagram-canvas" id="canvas-nonfunc">
          <svg class="svg-layer" id="svg-nonfunc"></svg>
        </div>
      </div>

      <div class="diagram" data-type="interface">
        <div class="title">Макет окна приложения</div>
        <div class="window-mock" id="window-mock">
          <div class="win-header">
            <div class="win-dots"><div class="dot r"></div><div class="dot y"></div><div class="dot g"></div></div>
            <div style="flex:1"></div>
            <div style="color:var(--muted);font-size:13px">Приложение — пример</div>
          </div>
          <div class="form-row">
            <input class="input" placeholder="Поле ввода: Поиск" id="searchField">
            <button class="btn btn-small">Найти</button>
          </div>
          <div class="form-row">
            <input class="input" placeholder="Поле ввода: Фильтр">
            <select class="input" style="max-width:120px"><option>Все</option><option>Категория</option></select>
          </div>
          <div style="display:flex;gap:10px">
            <div style="flex:2">
              <div style="height:140px;background:rgba(255,255,255,0.01);border-radius:8px;padding:8px;overflow:auto"> <table class="table"><tr><td contenteditable>Пользователь</td><td contenteditable>Статус</td></tr><tr><td contenteditable>Ivan</td><td contenteditable>Новый</td></tr></table></div>
            </div>
            <div style="flex:1;display:flex;flex-direction:column;gap:8px">
              <button class="btn">Создать</button>
              <button class="btn">Экспорт</button>
              <button class="btn">Настройки</button>
            </div>
          </div>
        </div>
      </div>

      <div class="diagram" data-type="er">
        <div class="title">ER-диаграмма</div>
        <div class="diagram-canvas" id="canvas-er">
          <svg class="svg-layer" id="svg-er"></svg>
        </div>
      </div>

      <div class="diagram" data-type="reliability">
        <div class="title">Обработка ошибок</div>
        <div class="diagram-canvas" id="canvas-rel">
          <svg class="svg-layer" id="svg-rel"></svg>
        </div>
      </div>

      <div class="diagram" data-type="security">
        <div class="title">Уровни защиты</div>
        <div class="diagram-canvas" id="canvas-sec">
          <svg class="svg-layer" id="svg-sec"></svg>
        </div>
      </div>

      <div class="diagram" data-type="perf">
        <div class="title">Показатели производительности</div>
        <div class="diagram-canvas" id="canvas-perf">
          <svg class="svg-layer" id="svg-perf"></svg>
        </div>
      </div>

      <div class="diagram" data-type="constraints">
        <div class="title">Ограничения системы</div>
        <div class="diagram-canvas" id="canvas-const">
          <svg class="svg-layer" id="svg-const"></svg>
        </div>
      </div>

      <div class="diagram" data-type="integrated">
        <div class="title">Интегрированная схема требований</div>
        <div class="diagram-canvas" id="canvas-integrated">
          <svg class="svg-layer" id="svg-integrated"></svg>
        </div>
      </div>

    </div>
    <div class="footer">Перетаскивайте и редактируйте текст в узлах. Нажмите Экспорт SVG чтобы сохранить диаграмму.</div>
  </div>

  <div class="sidebar">
    <div style="font-weight:600;margin-bottom:8px">Инструменты</div>
    <div class="legend">
      <div class="item">Перетащить узел</div>
      <div class="item">Дважды клик для редактирования</div>
      <div class="item">Экспорт активного SVG</div>
    </div>
    <div style="margin-top:12px">
      <button class="btn" onclick="focusDiagram('tree')">Дерево</button>
      <button class="btn" onclick="focusDiagram('functions')">Функции</button>
      <button class="btn" onclick="focusDiagram('er')">ER</button>
    </div>
  </div>
</div>

<script>
const board = document.getElementById('board')
function createNode(id, text, x, y, parent, svg){
  const el = document.createElement('div')
  el.className='node'
  el.style.left=x+'px'
  el.style.top=y+'px'
  el.id=id
  const inner = document.createElement('div')
  inner.className='label'
  inner.contentEditable=true
  inner.innerText=text
  el.appendChild(inner)
  parent.appendChild(el)
  makeDraggable(el, svg)
  return el
}
function makeDraggable(el, svg){
  let offsetX=0, offsetY=0, dragging=false
  el.addEventListener('mousedown',e=>{
    dragging=true
    offsetX=e.clientX-el.offsetLeft
    offsetY=e.clientY-el.offsetTop
    document.body.style.userSelect='none'
  })
  window.addEventListener('mousemove',e=>{
    if(!dragging) return
    el.style.left=(e.clientX-offsetX)+'px'
    el.style.top=(e.clientY-offsetY)+'px'
    updateAllLines()
  })
  window.addEventListener('mouseup',()=>{
    dragging=false
    document.body.style.userSelect='auto'
  })
}
function line(svg,x1,y1,x2,y2){
  const l=document.createElementNS('http://www.w3.org/2000/svg','line')
  l.setAttribute('x1',x1)
  l.setAttribute('y1',y1)
  l.setAttribute('x2',x2)
  l.setAttribute('y2',y2)
  l.setAttribute('stroke','rgba(200,230,255,0.35)')
  l.setAttribute('stroke-width','2')
  l.setAttribute('marker-end','url(#arr)')
  svg.appendChild(l)
  return l
}
function arrowDefs(svg){
  const defs=document.createElementNS('http://www.w3.org/2000/svg','defs')
  const marker=document.createElementNS('http://www.w3.org/2000/svg','marker')
  marker.setAttribute('id','arr')
  marker.setAttribute('markerWidth','10')
  marker.setAttribute('markerHeight','10')
  marker.setAttribute('refX','8')
  marker.setAttribute('refY','5')
  marker.setAttribute('orient','auto')
  const path=document.createElementNS('http://www.w3.org/2000/svg','path')
  path.setAttribute('d','M0,0 L10,5 L0,10 z')
  path.setAttribute('fill','rgba(200,230,255,0.4)')
  marker.appendChild(path)
  defs.appendChild(marker)
  svg.appendChild(defs)
}
function connect(svg, a, b){
  return line(svg,0,0,0,0)
}
function posCenter(el){
  const r=el.getBoundingClientRect()
  const p=board.getBoundingClientRect()
  return {x:r.left-p.left+r.width/2,y:r.top-p.top+r.height/2}
}
const links=[]
function updateAllLines(){
  links.forEach(l=>{
    const a=posCenter(l.a)
    const b=posCenter(l.b)
    l.line.setAttribute('x1',a.x)
    l.line.setAttribute('y1',a.y)
    l.line.setAttribute('x2',b.x)
    l.line.setAttribute('y2',b.y)
  })
}
function build(){
  const svgTree=document.getElementById('svg-tree')
  arrowDefs(svgTree)
  const root=createNode('root','Требования ПО',360,20,document.getElementById('canvas-tree'),svgTree)
  const f=createNode('f','Функциональные',120,140,document.getElementById('canvas-tree'),svgTree)
  const nf=createNode('nf','Нефункциональные',360,140,document.getElementById('canvas-tree'),svgTree)
  const sys=createNode('sys','Системные',600,140,document.getElementById('canvas-tree'),svgTree)
  links.push({a:root,b:f,line:connect(svgTree,root,f)})
  links.push({a:root,b:nf,line:connect(svgTree,root,nf)})
  links.push({a:root,b:sys,line:connect(svgTree,root,sys)})

  const svgFunc=document.getElementById('svg-functions')
  arrowDefs(svgFunc)
  const reg=createNode('reg','Регистрация',40,20,document.getElementById('canvas-functions'),svgFunc)
  const auth=createNode('auth','Авторизация',240,20,document.getElementById('canvas-functions'),svgFunc)
  const search=createNode('search','Поиск данных',440,20,document.getElementById('canvas-functions'),svgFunc)
  const exportNode=createNode('export','Экспорт отчётов',240,140,document.getElementById('canvas-functions'),svgFunc)
  links.push({a:reg,b:auth,line:connect(svgFunc,reg,auth)})
  links.push({a:auth,b:search,line:connect(svgFunc,auth,search)})
  links.push({a:search,b:exportNode,line:connect(svgFunc,search,exportNode)})
  links.push({a:auth,b:exportNode,line:connect(svgFunc,auth,exportNode)})

  const svgNon=document.getElementById('svg-nonfunc')
  arrowDefs(svgNon)
  const perf=createNode('perf','Производительность',80,20,document.getElementById('canvas-nonfunc'),svgNon)
  const sec=createNode('sec','Безопасность',260,20,document.getElementById('canvas-nonfunc'),svgNon)
  const ux=createNode('ux','Удобство',440,20,document.getElementById('canvas-nonfunc'),svgNon)
  const compat=createNode('compat','Совместимость',260,140,document.getElementById('canvas-nonfunc'),svgNon)
  links.push({a:perf,b:ux,line:connect(svgNon,perf,ux)})
  links.push({a:sec,b:compat,line:connect(svgNon,sec,compat)})
  links.push({a:compat,b:ux,line:connect(svgNon,compat,ux)})

  const svgEr=document.getElementById('svg-er')
  arrowDefs(svgEr)
  const users=createNode('u','Пользователи',80,20,document.getElementById('canvas-er'),svgEr)
  const orders=createNode('o','Заказы',260,20,document.getElementById('canvas-er'),svgEr)
  const items=createNode('it','Товары',440,20,document.getElementById('canvas-er'),svgEr)
  links.push({a:users,b:orders,line:connect(svgEr,users,orders)})
  links.push({a:orders,b:items,line:connect(svgEr,orders,items)})

  const svgRel=document.getElementById('svg-rel')
  arrowDefs(svgRel)
  const e1=createNode('e1','Ошибка ввода данных',40,20,document.getElementById('canvas-rel'),svgRel)
  const e2=createNode('e2','Вывод сообщения',240,20,document.getElementById('canvas-rel'),svgRel)
  const e3=createNode('e3','Повторный ввод',440,20,document.getElementById('canvas-rel'),svgRel)
  const e4=createNode('e4','Сохранение данных',240,120,document.getElementById('canvas-rel'),svgRel)
  links.push({a:e1,b:e2,line:connect(svgRel,e1,e2)})
  links.push({a:e2,b:e3,line:connect(svgRel,e2,e3)})
  links.push({a:e3,b:e4,line:connect(svgRel,e3,e4)})

  const svgSec=document.getElementById('svg-sec')
  arrowDefs(svgSec)
  const a1=createNode('a1','Авторизация',60,20,document.getElementById('canvas-sec'),svgSec)
  const a2=createNode('a2','Проверка прав доступа',260,20,document.getElementById('canvas-sec'),svgSec)
  const a3=createNode('a3','Шифрование данных',460,20,document.getElementById('canvas-sec'),svgSec)
  const a4=createNode('a4','Резервное копирование',260,120,document.getElementById('canvas-sec'),svgSec)
  links.push({a:a1,b:a2,line:connect(svgSec,a1,a2)})
  links.push({a:a2,b:a3,line:connect(svgSec,a2,a3)})
  links.push({a:a3,b:a4,line:connect(svgSec,a3,a4)})

  const svgPerf=document.getElementById('svg-perf')
  arrowDefs(svgPerf)
  const p1=createNode('p1','Время отклика',80,20,document.getElementById('canvas-perf'),svgPerf)
  const p2=createNode('p2','Кол-во пользователей',280,20,document.getElementById('canvas-perf'),svgPerf)
  const p3=createNode('p3','Скорость обработки',480,20,document.getElementById('canvas-perf'),svgPerf)
  links.push({a:p1,b:p2,line:connect(svgPerf,p1,p2)})
  links.push({a:p2,b:p3,line:connect(svgPerf,p2,p3)})
  links.push({a:p1,b:p3,line:connect(svgPerf,p1,p3)})

  const svgConst=document.getElementById('svg-const')
  arrowDefs(svgConst)
  const c1=createNode('c1','ОС, версия',60,20,document.getElementById('canvas-const'),svgConst)
  const c2=createNode('c2','Версия Python / Libs',260,20,document.getElementById('canvas-const'),svgConst)
  const c3=createNode('c3','Доступ к сети',460,20,document.getElementById('canvas-const'),svgConst)
  links.push({a:c1,b:c2,line:connect(svgConst,c1,c2)})
  links.push({a:c2,b:c3,line:connect(svgConst,c2,c3)})

  const svgInt=document.getElementById('svg-integrated')
  arrowDefs(svgInt)
  const i1=createNode('i1','Функциональные',60,20,document.getElementById('canvas-integrated'),svgInt)
  const i2=createNode('i2','Нефункциональные',260,20,document.getElementById('canvas-integrated'),svgInt)
  const i3=createNode('i3','Системные',460,20,document.getElementById('canvas-integrated'),svgInt)
  const i4=createNode('i4','Интерфейс',160,140,document.getElementById('canvas-integrated'),svgInt)
  const i5=createNode('i5','Ограничения',360,140,document.getElementById('canvas-integrated'),svgInt)
  links.push({a:i1,b:i4,line:connect(svgInt,i1,i4)})
  links.push({a:i2,b:i4,line:connect(svgInt,i2,i4)})
  links.push({a:i3,b:i5,line:connect(svgInt,i3,i5)})
  links.push({a:i4,b:i5,line:connect(svgInt,i4,i5)})

  updateAllLines()
}
window.addEventListener('load',()=>{
  build()
})
document.getElementById('addNode').addEventListener('click',()=>{
  const el=createNode('n'+Date.now(),'Новый узел',20,600,document.querySelector('.board'),document.createElement('svg'))
})
document.getElementById('reset').addEventListener('click',()=>{
  document.querySelectorAll('.node').forEach((n,i)=>{n.style.left=(20+((i%6)*160))+'px';n.style.top=(20+Math.floor(i/6)*120)+'px'})
  updateAllLines()
})
document.getElementById('exportBtn').addEventListener('click',()=>{
  const svgs=document.querySelectorAll('.svg-layer')
  if(svgs.length>0){
    const s=svgs[0].outerHTML
    const blob=new Blob([s],{type:'image/svg+xml'})
    const url=URL.createObjectURL(blob)
    const a=document.createElement('a')
    a.href=url
    a.download='diagram.svg'
    a.click()
    URL.revokeObjectURL(url)
  }
})
function focusDiagram(name){
  const el=document.querySelector('[data-type="'+name+'"]')
  if(el) el.scrollIntoView({behavior:'smooth',block:'center'})
}
</script>
</body>
</html>