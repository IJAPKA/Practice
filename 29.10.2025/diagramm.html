<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UML Диаграммы</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .diagram-selector {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #4a6ee0;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        button:hover {
            background-color: #3a5ecf;
            transform: translateY(-2px);
        }
        
        button.active {
            background-color: #2d4bb7;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .canvas-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: auto;
            min-height: 600px;
            position: relative;
        }
        
        #diagramCanvas {
            display: block;
            margin: 0 auto;
        }
        
        .instructions {
            margin-top: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .instructions h3 {
            color: #4a6ee0;
            margin-bottom: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .diagram-selector {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>UML Диаграммы</h1>
            <p class="subtitle">Activity Diagram и State Diagram</p>
        </header>
        
        <div class="controls">
            <div class="diagram-selector">
                <button id="activityBtn" class="active">Activity Diagram</button>
                <button id="stateBtn">State Diagram</button>
            </div>
            <button id="downloadBtn">Скачать диаграмму</button>
        </div>
        
        <div class="canvas-container">
            <canvas id="diagramCanvas" width="1100" height="600"></canvas>
        </div>
        
        <div class="instructions">
            <h3>Инструкция</h3>
            <p>Выберите тип диаграммы для отображения. Используйте кнопку "Скачать диаграмму" для сохранения изображения.</p>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4a6ee0;"></div>
                    <span>Начальное состояние</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2d4bb7;"></div>
                    <span>Конечное состояние</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #34c759;"></div>
                    <span>Действие/Состояние</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff9500;"></div>
                    <span>Решение/Ветвление</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Диаграммы UML: Activity Diagram и State Diagram</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('diagramCanvas');
            const ctx = canvas.getContext('2d');
            const activityBtn = document.getElementById('activityBtn');
            const stateBtn = document.getElementById('stateBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            let currentDiagram = 'activity';
            
            // Цвета для элементов диаграммы
            const colors = {
                start: '#4a6ee0',
                end: '#2d4bb7',
                activity: '#34c759',
                decision: '#ff9500',
                text: '#333333',
                line: '#666666'
            };
            
            // Функция для рисования Activity Diagram
            function drawActivityDiagram() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Начальное состояние
                drawStartState(100, 100);
                
                // Действия
                drawActivity(100, 180, 'Communication');
                drawActivity(100, 260, 'Modeling');
                drawActivity(100, 340, 'Development');
                drawActivity(300, 340, 'Testing');
                drawActivity(500, 340, 'Deployment');
                
                // Конечное состояние
                drawEndState(500, 420);
                
                // Решение
                drawDecision(300, 420);
                
                // Соединительные линии
                drawLine(100, 120, 100, 160); // Начало -> Communication
                drawLine(100, 220, 100, 240); // Communication -> Modeling
                drawLine(100, 300, 100, 320); // Modeling -> Development
                drawLine(100, 380, 100, 420); // Development -> Testing
                drawLine(140, 340, 260, 340); // Development -> Testing (горизонтальная)
                drawLine(340, 340, 460, 340); // Testing -> Deployment
                drawLine(500, 380, 500, 400); // Deployment -> Конец
                drawLine(300, 380, 300, 400); // Testing -> Решение
                drawLine(260, 420, 100, 420); // Решение -> Development
                
                // Текст для линий
                drawText('SoW', 70, 240);
                drawText('Product', 200, 320);
                drawText('Report', 430, 380);
                drawText('Errors found', 150, 440);
            }
            
            // Функция для рисования State Diagram
            function drawStateDiagram() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Состояния
                drawState(100, 100, 'Card Inserted');
                drawState(100, 200, 'Entering PIN');
                drawState(100, 300, 'Validating PIN');
                drawState(300, 300, 'Main Menu');
                drawState(500, 300, 'Performing Transaction');
                drawState(500, 200, 'Ejecting Card');
                drawState(500, 100, 'Session Ended');
                
                // Начальное состояние
                drawStartState(50, 100);
                
                // Конечное состояние
                drawEndState(550, 100);
                
                // Соединительные линии
                drawArrow(70, 100, 90, 100); // Начало -> Card Inserted
                drawLine(100, 140, 100, 180); // Card Inserted -> Entering PIN
                drawLine(100, 240, 100, 280); // Entering PIN -> Validating PIN
                drawLine(140, 300, 260, 300); // Validating PIN -> Main Menu
                drawLine(340, 300, 460, 300); // Main Menu -> Performing Transaction
                drawLine(500, 260, 500, 220); // Performing Transaction -> Ejecting Card
                drawLine(500, 140, 500, 120); // Ejecting Card -> Session Ended
                drawArrow(520, 100, 540, 100); // Session Ended -> Конец
                
                // Альтернативные переходы
                drawLine(140, 320, 200, 400, 460, 400, 500, 340); // Validating PIN -> Performing Transaction (альтернативный путь)
                drawLine(300, 340, 300, 400, 100, 400, 100, 340); // Main Menu -> Validating PIN
                
                // Текст для переходов
                drawText('Insert Card', 60, 80);
                drawText('Enter PIN', 60, 240);
                drawText('PIN OK', 180, 280);
                drawText('PIN Error', 180, 420);
                drawText('Withdraw', 400, 280);
                drawText('Cancel', 180, 380);
            }
            
            // Функция для рисования начального состояния
            function drawStartState(x, y) {
                ctx.fillStyle = colors.start;
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Функция для рисования конечного состояния
            function drawEndState(x, y) {
                ctx.fillStyle = colors.end;
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = colors.end;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, y, 15, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // Функция для рисования действия
            function drawActivity(x, y, text) {
                const width = 160;
                const height = 40;
                
                ctx.fillStyle = colors.activity;
                ctx.fillRect(x - width/2, y - height/2, width, height);
                
                ctx.strokeStyle = colors.line;
                ctx.lineWidth = 1;
                ctx.strokeRect(x - width/2, y - height/2, width, height);
                
                drawText(text, x, y);
            }
            
            // Функция для рисования состояния
            function drawState(x, y, text) {
                const width = 160;
                const height = 60;
                
                ctx.fillStyle = colors.activity;
                ctx.strokeStyle = colors.line;
                ctx.lineWidth = 1;
                
                ctx.beginPath();
                ctx.roundRect(x - width/2, y - height/2, width, height, 10);
                ctx.fill();
                ctx.stroke();
                
                drawText(text, x, y);
            }
            
            // Функция для рисования решения/ветвления
            function drawDecision(x, y) {
                const size = 30;
                
                ctx.fillStyle = colors.decision;
                ctx.beginPath();
                ctx.moveTo(x, y - size/2);
                ctx.lineTo(x + size/2, y);
                ctx.lineTo(x, y + size/2);
                ctx.lineTo(x - size/2, y);
                ctx.closePath();
                ctx.fill();
                
                ctx.strokeStyle = colors.line;
                ctx.lineWidth = 1;
                ctx.stroke();
            }
            
            // Функция для рисования линии
            function drawLine(fromX, fromY, toX, toY) {
                ctx.strokeStyle = colors.line;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(fromX, fromY);
                ctx.lineTo(toX, toY);
                ctx.stroke();
            }
            
            // Функция для рисования линии с изгибами
            function drawLine(fromX, fromY, ctrl1X, ctrl1Y, ctrl2X, ctrl2Y, toX, toY) {
                ctx.strokeStyle = colors.line;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(fromX, fromY);
                ctx.bezierCurveTo(ctrl1X, ctrl1Y, ctrl2X, ctrl2Y, toX, toY);
                ctx.stroke();
            }
            
            // Функция для рисования стрелки
            function drawArrow(fromX, fromY, toX, toY) {
                drawLine(fromX, fromY, toX, toY);
                
                // Рисуем наконечник стрелки
                const headlen = 10;
                const angle = Math.atan2(toY - fromY, toX - fromX);
                
                ctx.strokeStyle = colors.line;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(toX, toY);
                ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI/6), toY - headlen * Math.sin(angle - Math.PI/6));
                ctx.moveTo(toX, toY);
                ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI/6), toY - headlen * Math.sin(angle + Math.PI/6));
                ctx.stroke();
            }
            
            // Функция для рисования текста
            function drawText(text, x, y) {
                ctx.fillStyle = colors.text;
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(text, x, y);
            }
            
            // Обработчики событий для кнопок
            activityBtn.addEventListener('click', function() {
                currentDiagram = 'activity';
                activityBtn.classList.add('active');
                stateBtn.classList.remove('active');
                drawActivityDiagram();
            });
            
            stateBtn.addEventListener('click', function() {
                currentDiagram = 'state';
                stateBtn.classList.add('active');
                activityBtn.classList.remove('active');
                drawStateDiagram();
            });
            
            downloadBtn.addEventListener('click', function() {
                const link = document.createElement('a');
                link.download = `${currentDiagram}-diagram.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
            
            // Инициализация с Activity Diagram
            drawActivityDiagram();
        });
    </script>
</body>
</html>